<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>POS Warung Ibu Deni - Pro</title>
    <style>
        :root { --prm: #2c3e50; --sec: #27ae60; --accent: #e67e22; --danger: #e74c3c; --light: #f4f7f6; --blue: #3498db; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--light); margin: 0; padding-bottom: 160px; }
        
        .header { background: var(--prm); color: white; padding: 15px; text-align: center; position: sticky; top: 0; z-index: 1000; }
        
        /* Bar Status Modern */
        .status-bar { padding: 8px; font-size: 13px; font-weight: bold; text-align: center; transition: 0.3s; letter-spacing: 1px; }
        .open { background: #2ecc71; color: white; box-shadow: inset 0 -3px 0 rgba(0,0,0,0.1); }
        .closed { background: #e74c3c; color: white; box-shadow: inset 0 -3px 0 rgba(0,0,0,0.1); }

        .container { padding: 15px; max-width: 600px; margin: auto; }

        /* Tombol Saklar Mod Puasa */
        .mode-selector {
            background: white; padding: 15px; border-radius: 15px; margin-bottom: 20px;
            display: flex; justify-content: space-between; align-items: center;
            border: 2px solid #ddd;
        }
        .switch { position: relative; display: inline-block; width: 60px; height: 30px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
        .slider:before { position: absolute; content: ""; height: 22px; width: 22px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: #9b59b6; }
        input:checked + .slider:before { transform: translateX(30px); }

        .income-card { 
            background: linear-gradient(135deg, #27ae60, #2ecc71); 
            color: white; padding: 20px; border-radius: 15px; 
            margin-bottom: 20px; text-align: center; box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
        }

        .panel { background: white; padding: 15px; border-radius: 15px; margin-bottom: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        h2 { font-size: 14px; color: var(--prm); border-left: 4px solid var(--accent); padding-left: 10px; margin-bottom: 12px; text-transform: uppercase; }

        input[type="text"], input[type="number"] { width: 100%; padding: 12px; margin: 8px 0; border: 1px solid #ddd; border-radius: 10px; box-sizing: border-box; }
        
        .btn-add { background: var(--prm); color: white; border: none; width: 100%; padding: 12px; border-radius: 10px; font-weight: bold; }
        
        .btn-group { display: flex; gap: 10px; margin-bottom: 20px; }
        .btn-opt { flex: 1; padding: 12px; border: none; border-radius: 10px; font-size: 11px; font-weight: bold; color: white; }

        .grid-menu { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .card-item { background: white; padding: 15px; border-radius: 12px; text-align: center; border: 1px solid #eee; position: relative; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        
        .counter { display: flex; justify-content: center; align-items: center; gap: 10px; margin-top: 10px; }
        .btn-qty { border: none; width: 32px; height: 32px; border-radius: 8px; background: #dfe4ea; font-weight: bold; }
        .btn-qty.plus { background: var(--accent); color: white; }

        .log-item { background: white; padding: 12px; border-radius: 10px; margin-bottom: 8px; border-left: 4px solid var(--prm); font-size: 12px; display: flex; justify-content: space-between; align-items: center; }

        .footer-bar { position: fixed; bottom: 0; left: 0; right: 0; background: white; padding: 15px 20px; border-top: 2px solid #eee; display: flex; justify-content: space-between; align-items: center; z-index: 1000; box-shadow: 0 -5px 15px rgba(0,0,0,0.05); }
        .btn-save { background: var(--sec); color: white; border: none; padding: 12px 25px; border-radius: 12px; font-weight: bold; font-size: 15px; }
    </style>
</head>
<body>

<div class="header">
    <h1>WARUNG IBU DENI</h1>
    <div id="clock" style="font-size: 11px; margin-top: 3px; opacity: 0.9;"></div>
</div>
<div id="shopStatus" class="status-bar">MENGECEK WAKTU...</div>

<div class="container">
    <div class="mode-selector">
        <b id="modeLabel">üìÖ MODE HARI BIASA</b>
        <label class="switch">
            <input type="checkbox" id="modeSwitch" onchange="handleModeChange()">
            <span class="slider"></span>
        </label>
    </div>

    <div class="income-card">
        <small>PENDAPATAN HARI INI</small>
        <h1 id="incomeToday" style="margin: 5px 0; font-size: 32px;">Rp 0</h1>
    </div>

    <div class="btn-group">
        <button class="btn-opt" style="background:var(--blue)" onclick="exportLaporan()">üì• DOWNLOAD LAPORAN</button>
        <button class="btn-opt" style="background:var(--danger)" onclick="tutupBuku()">üö© TUTUP BUKU</button>
    </div>

    <div class="panel">
        <h2>TAMBAH MENU</h2>
        <input type="text" id="addNama" placeholder="Contoh: Pempek Telur">
        <input type="number" id="addHarga" placeholder="Harga (Contoh: 15000)">
        <button class="btn-add" onclick="saveMenu()">+ SIMPAN MENU</button>
    </div>

    <input type="text" id="searchMenu" style="border: 2px solid var(--accent); font-size: 16px;" placeholder="üîé Cari nama makanan..." onkeyup="filterMenu()">
    
    <div class="grid-menu" id="menuArea" style="margin-top: 15px;"></div>

    <h2 style="margin-top: 30px;">RIWAYAT TRANSAKSI</h2>
    <div id="historyArea"></div>
</div>

<div class="footer-bar">
    <div>
        <small style="color: #888;">TOTAL BAYAR</small>
        <div id="grandTotal" style="font-size: 22px; font-weight: 800; color: var(--prm);">Rp 0</div>
    </div>
    <button class="btn-save" onclick="simpanTransaksi()">SELESAI</button>
</div>

<script>
    let db_menu = JSON.parse(localStorage.getItem('deni_vfinal_menu')) || [];
    let db_history = JSON.parse(localStorage.getItem('deni_vfinal_logs')) || [];
    let cart = {};

    function updateClock() {
        const now = new Date();
        document.getElementById('clock').innerText = now.toLocaleString('id-ID', { dateStyle: 'full', timeStyle: 'medium' });
        updateStatus();
    }
    setInterval(updateClock, 1000);

    function handleModeChange() {
        const isPuasa = document.getElementById('modeSwitch').checked;
        document.getElementById('modeLabel').innerText = isPuasa ? "üåô MODE BULAN PUASA" : "üìÖ MODE HARI BIASA";
        updateStatus();
    }

    function updateStatus() {
        const now = new Date();
        const hour = now.getHours();
        const min = now.getMinutes();
        const timeVal = hour + (min / 60);
        const isPuasa = document.getElementById('modeSwitch').checked;
        const statusEl = document.getElementById('shopStatus');
        
        let isOpen = false;
        let jadwalTxt = "";

        if (isPuasa) {
            jadwalTxt = "(Jadwal: 14:30 - 18:30)";
            if (timeVal >= 14.5 && timeVal < 18.5) isOpen = true;
        } else {
            jadwalTxt = "(Jadwal: 06:00 - 12:00)";
            if (timeVal >= 6 && timeVal < 12) isOpen = true;
        }

        if (isOpen) {
            statusEl.innerText = "‚óè WARUNG SEDANG BUKA " + jadwalTxt;
            statusEl.className = "status-bar open";
        } else {
            statusEl.innerText = "‚óã WARUNG SUDAH TUTUP " + jadwalTxt;
            statusEl.className = "status-bar closed";
        }
    }

    // FUNGSI INTI
    function saveMenu() {
        const n = document.getElementById('addNama').value;
        const h = parseInt(document.getElementById('addHarga').value);
        if(n && h) {
            db_menu.push({ nama: n, harga: h });
            localStorage.setItem('deni_vfinal_menu', JSON.stringify(db_menu));
            renderMenu();
            document.getElementById('addNama').value = ""; 
            document.getElementById('addHarga').value = "";
        }
    }

    function renderMenu() {
        const area = document.getElementById('menuArea');
        area.innerHTML = "";
        db_menu.forEach((item, i) => {
            area.innerHTML += `
                <div class="card-item" data-name="${item.nama.toLowerCase()}">
                    <button style="position:absolute;right:5px;top:5px;border:none;background:none;color:#ddd;font-size:18px;" onclick="deleteMenu(${i})">√ó</button>
                    <b>${item.nama}</b><br>
                    <span style="color:var(--accent); font-weight:bold;">Rp ${item.harga.toLocaleString()}</span>
                    <div class="counter">
                        <button class="btn-qty" onclick="qty('${item.nama}', ${item.harga}, -1)">-</button>
                        <span id="q-${item.nama}" style="font-weight:bold; min-width:20px;">0</span>
                        <button class="btn-qty plus" onclick="qty('${item.nama}', ${item.harga}, 1)">+</button>
                    </div>
                </div>`;
        });
    }

    function qty(nama, harga, delta) {
        if(!cart[nama]) cart[nama] = { q: 0, p: harga };
        cart[nama].q += delta;
        if(cart[nama].q <= 0) delete cart[nama];
        const display = document.getElementById(`q-${nama}`);
        if(display) display.innerText = cart[nama] ? cart[nama].q : 0;
        updateTotal();
    }

    function updateTotal() {
        let total = 0;
        for(let k in cart) total += cart[k].q * cart[k].p;
        document.getElementById('grandTotal').innerText = "Rp " + total.toLocaleString();
        return total;
    }

    function simpanTransaksi() {
        const total = updateTotal();
        if(total === 0) return alert("Belum ada pesanan!");
        
        const now = new Date();
        let detail = "";
        for(let k in cart) detail += `${k}(${cart[k].q}) `;
        
        db_history.push({ 
            id: Date.now(), 
            tgl: now.toLocaleString('id-ID'), 
            tglShort: now.toLocaleDateString('id-ID'), 
            item: detail, 
            total: total 
        });
        
        localStorage.setItem('deni_vfinal_logs', JSON.stringify(db_history));
        cart = {}; 
        renderMenu(); 
        updateTotal(); 
        renderHistory();
        alert("Transaksi Tersimpan!");
    }

    function renderHistory() {
        const area = document.getElementById('historyArea');
        area.innerHTML = "";
        const tglHariIni = new Date().toLocaleDateString('id-ID');
        let income = 0;
        db_history.slice().reverse().forEach(log => {
            if(log.tglShort === tglHariIni) income += log.total;
            area.innerHTML += `
                <div class="log-item">
                    <div><span style="color:#999;font-size:10px;">${log.tgl}</span><br><b>Rp ${log.total.toLocaleString()}</b> - ${log.item}</div>
                    <button style="border:none;background:none;color:var(--danger);font-size:18px;" onclick="deleteLog(${log.id})">üóëÔ∏è</button>
                </div>`;
        });
        document.getElementById('incomeToday').innerText = "Rp " + income.toLocaleString();
    }

    function exportLaporan() {
        if(db_history.length === 0) return alert("Belum ada data.");
        let csv = "Tanggal,Item,Total\n";
        db_history.forEach(l => { csv += `${l.tgl},"${l.item}",${l.total}\n`; });
        const blob = new Blob([csv], { type: 'text/csv' });
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = `Laporan_Warung_Deni.csv`;
        a.click();
    }

    function tutupBuku() {
        if(confirm("Tutup Buku? Riwayat transaksi lama akan dihapus agar aplikasi tetap ringan.")) {
            db_history = [];
            localStorage.setItem('deni_vfinal_logs', JSON.stringify(db_history));
            renderHistory();
        }
    }

    function deleteMenu(index) {
        if(confirm("Hapus menu ini dari daftar?")) {
            db_menu.splice(index, 1);
            localStorage.setItem('deni_vfinal_menu', JSON.stringify(db_menu));
            renderMenu();
        }
    }

    function deleteLog(id) {
        if(confirm("Hapus catatan transaksi ini?")) {
            db_history = db_history.filter(l => l.id !== id);
            localStorage.setItem('deni_vfinal_logs', JSON.stringify(db_history));
            renderHistory();
        }
    }

    function filterMenu() {
        let kw = document.getElementById('searchMenu').value.toLowerCase();
        let items = document.getElementsByClassName('card-item');
        for (let it of items) it.style.display = it.getAttribute('data-name').includes(kw) ? "block" : "none";
    }

    renderMenu(); 
    renderHistory(); 
    updateClock();
</script>

</body>
</html>
